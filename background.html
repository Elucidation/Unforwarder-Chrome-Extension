<script>
// Script run on a google search result page, replacing all google-forwarded result links with original links in place.
// Example starting google-forwarded url :
//              http://www.google.com/url?sa=t&rct=j&q=fear%20not%20the%20valient&source=web&cd=1&ved=0CCAQFjAA&url=http%3A%2F%2Fen.wikiquote.org%2Fwiki%2FCourage&ei=QiiyTu2QGZHAtgfB762cAg&usg=AFQjCNHOaIV8vNJ1fxGxdNmYkl3v9jpumw&sig2=IbeYKkY9u-lfRGUA38gRtw
// Fixed ending url: 
//              http://en.wikiquote.org/wiki/Courage
// https://github.com/Elucidation/Unforwarder-Chrome-Extension
// Author : Sameer Ansari
var replaceForwards = function(tab) {  
  chrome.tabs.executeScript( null, {file: "replace_script.js"} );
};

var checkComplete = function(tabId,info) {
   if (info.status == "complete") {
      // Ugly hack to deal with google search results post-loading results
      // Even though page is considered finished loading, the changes get overwritten
      // So run script at 0.5 seconds, 1, 1.5, 2, 5, and 10 seconds.
      setTimeout(replaceForwards, 500);
      setTimeout(replaceForwards, 1000);
      setTimeout(replaceForwards, 1500);
      setTimeout(replaceForwards, 2000);
      setTimeout(replaceForwards, 5000);
      setTimeout(replaceForwards, 10000);
   }
}

chrome.tabs.onUpdated.addListener(checkComplete);
// Button click listener
chrome.browserAction.onClicked.addListener(replaceForwards);
</script>

